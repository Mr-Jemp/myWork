<!DOCTYPE HTML>
<html>
 <head>
    <title>WEB表单设计器</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link href="css/bootstrap/css/bootstrap.css?2023" rel="stylesheet" type="text/css" />
    <!--[if lte IE 6]>
    <link rel="stylesheet" type="text/css" href="css/bootstrap/css/bootstrap-ie6.css?2023">
    <![endif]-->
    <!--[if lte IE 7]>
    <link rel="stylesheet" type="text/css" href="css/bootstrap/css/ie.css?2023">
    <![endif]-->
    <link href="css/site.css?2023" rel="stylesheet" type="text/css" />
	<script type="text/javascript" charset="utf-8" src="js/jquery-1.7.2.min.js?2023"></script>
    <script type="text/javascript">
        var _root='http://form/index.php?s=/',_controller = 'index';
		$(function()
		{
			$("#leftArrows").css({"position":"absolute"});
			$("#leftArrows").css({"background":"url('/resource/images/common/ueditor_right.png') no-repeat -26px"});
			$("#leftArrows").css({"top":"0px"});
			$("#leftArrows").css({"left":"0px"});
			$("#leftArrows").css({"cursor":"pointer"});
			$("#leftArrows").attr("bg","1_05");
			$("#leftArrows").width(10);
			$("#leftArrows").height(47);

			$(".well-small").css({"background-color":"#f5f5f5"});
			$(".well-small").css({"box-shadow":"0px 1px 1px #eeeeee inset"});
			$(".well-small").css({"border":"1px solid #E3E3E3"});
			
			$(".well-small-box").height(47);
			$(".well-small-box").css({"overflow":"hidden"});
			
			$("#leftArrows").bind("click",function()
			{
				if($("#leftArrows").attr("bg")=="1_05")
				{
					 
					$("#leftArrows").css({"background":"url('/resource/images/common/ueditor_left.png') no-repeat -26px"});
					$("#leftArrows").attr("bg","1_032");
					$(".well-small-box").slideToggle("hide");
					return;
				}
				$(".well-small-box").slideToggle("show");
				$("#leftArrows").attr("bg","1_05");
				$("#leftArrows").css({"background":"url('/resource/images/common/ueditor_right.png') no-repeat -26px"});
			});
		});
    </script>
	<style>
	.btn{line-height:10px;padding: 5px 5px;font-size:10px;}
	</style>
 </head>
<body style="margin-top:5px">


<div class="container">
<form method="post" id="saveform" name="saveform" action="">
<input type="hidden" name="fields" id="fields" value="0">
<div class="row">

     
</div>
	<div id="leftArrows"></div>
	<div class="well-small-box">
		<div class="well-small" style="border-radius:0;">
			<p style="margin: 0 0 0px;">
			<button type="button" onClick="leipiFormDesign.exec('text');" class="btn btn-info">文本框</button>
			<button type="button" onClick="leipiFormDesign.exec('textarea');" class="btn btn-info">多行文本</button>
			<button type="button" onClick="leipiFormDesign.exec('select');" class="btn btn-info">下拉菜单</button>
			<button type="button" onClick="leipiFormDesign.exec('radios');" class="btn btn-info">单选框</button>
			<button type="button" onClick="leipiFormDesign.exec('checkboxs');" class="btn btn-info">复选框</button>
			<button type="button" onClick="leipiFormDesign.exec('macros');" class="btn btn-info">宏控件</button>
			<button type="button" onClick="leipiFormDesign.exec('progressbar');" class="btn btn-info">进度条</button>
			<button type="button" onClick="leipiFormDesign.exec('qrcode');" class="btn btn-info">二维码</button>
			<button type="button" onClick="leipiFormDesign.exec('listctrl');" class="btn btn-info">列表控件</button>
			<button type="button" onClick="leipiFormDesign.exec('formto');" class="btn btn-info">表单跳转</button>
			<button type="button" onClick="leipiFormDesign.exec('uploadfile');" class="btn btn-info">上传文件</button>
			<button type="button" onClick="leipiFormDesign.exec('imagelist');" class="btn btn-info">图片列表</button>
			<button type="button" onClick="leipiFormDesign.exec('free');" class="btn btn-info">树控件</button>
			<button type="button" onClick="leipiFormDesign.exec('sublist');" class="btn btn-info">子列表</button>
			<button type="button" onClick="leipiFormDesign.exec('expression');" class="btn btn-info">表达式</button>
			<button type="button" onClick="leipiFormDesign.exec('dynamictree');" class="btn btn-info">页面树</button>
			
			</p>

		</div>
	</div>
	
<div class="row">


<div class="span10" style="width:940px">

<script id="myFormDesign" type="text/plain" style="width:100%;">
</script>
<label style="display:inline"><input name="formtype" type="radio" value="0" > 普通页面</label>
<label style="margin-left:10px;display:inline"><input name="formtype" type="radio" value="1"> 数据页面</label>
<label style="margin-left:10px;display:inline"><input name="formtype" type="radio" value="2"> 单项页面</label>
</div>



</div><!--end row-->

</form>



</div><!--end container-->
<script type="text/javascript" charset="utf-8" src="js/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="js/ueditor/ueditor.all.min.js"> </script>
<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script type="text/javascript" charset="utf-8" src="js/ueditor/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript" charset="utf-8" src="js/ueditor/formdesign/leipi.formdesign.v4.js?2023"></script>
<!-- script start-->  
<script type="text/javascript">
var modelId=0;
var reg = new RegExp("(^|&)modelId=([^&]*)(&|$)","i");
var r = window.location.search.substr(1).match(reg);
if(r!=null) modelId=r[2];

$(window).load(function()
{
	$.ajax({
        type: 'get',
        url: '/s/tp/wwwroot/index.php?s=/demo/formdesign/form_id/'+modelId+'.html',
        dataType :'html',
        success: function(data) {
       		if(typeof data!="object")
            $("#myFormDesign").val(data);
            startEditor();
        }, error: function(xhr, stat, e) { alert("读取数据失败：找不到地址！");startEditor(); }
    });
	$.ajax({
        type: 'get',
        url: '/s/function/pagetype.php',
		data:{'formid':modelId},
        dataType :'text',
        success: function(data) {
			data=eval("("+data+")");
			if(data.IsSuccess!=true)return;
			if(typeof(data.info.is_data_form)=='object')data.info.is_data_form=0;
			$("input[name='formtype']:nth("+data.info.is_data_form+")").attr('checked',true);
        }, error: function(xhr, stat, e) { alert("读取数据失败：找不到页面类型地址！");startEditor(); }
    });
});
var leipiEditor =null,leipiFormDesign=null;
function startEditor()
{
	leipiEditor = UE.getEditor('myFormDesign',{
            //allowDivTransToP: false,//阻止转换div 为p
            toolleipi:true,//是否显示，设计器的 toolbars
            textarea: 'design_content',   
            //这里可以选择自己需要的工具按钮名称,此处仅选择如下五个
           toolbars:[[
            'fullscreen', 'source', '|', 'undo', 'redo', '|',
            'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist', 'selectall', 'cleardoc', '|',
            'rowspacingtop', 'rowspacingbottom', 'lineheight', '|',
            'customstyle', 'paragraph', 'fontfamily', 'fontsize', '|',
            'directionalityltr', 'directionalityrtl', 'indent', '|',
            'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'touppercase', 'tolowercase', '|',
            'link', 'unlink', 'anchor', '|', 'imagenone', 'imageleft', 'imageright', 'imagecenter', '|',
            'simpleupload', 'insertimage', 'emotion', 'scrawl', 'insertvideo', 'music', 'attachment', 'map', 'gmap', 'insertframe', 'insertcode', /*'webapp',*/ 'pagebreak', 'template', 'background', '|',
            'horizontal', 'date', 'time', 'spechars', 'snapscreen', 'wordimage', '|',
            'inserttable', 'deletetable', 'insertparagraphbeforetable', 'insertrow', 'deleterow', 'insertcol', 'deletecol', 'mergecells', 'mergeright', 'mergedown', 'splittocells', 'splittorows', 'splittocols', 'charts', '|',
            'print', 'searchreplace', 'help', 'drafts','textfield']],
            //focus时自动清空初始化时的内容
            //autoClearinitialContent:true,
            //关闭字数统计
            wordCount:false,
            //关闭elementPath
            elementPathEnabled:false,
            //默认的编辑区域高度
            initialFrameHeight:500
            ///,iframeCssUrl:"css/bootstrap/css/bootstrap.css" //引入自身 css使编辑器兼容你网站css
            //更多其他参数，请参考ueditor.config.js中的配置项
        });

         leipiFormDesign = {
            /*执行控件*/
            exec: function(method) {
                leipiEditor.execCommand(method);
            },
            /*
            Javascript 解析表单
            template 表单设计器里的Html内容
            fields 字段总数
            */
            parse_form: function(template, fields) {
                //正则  radios|checkboxs|select 匹配的边界 |--|  因为当使用 {} 时js报错
                var preg = /(\|-<span(((?!<span).)*leipiplugins=\"(radios|checkboxs|select)\".*?)>(.*?)<\/span>-\||<(img|input|textarea|select).*?(<\/select>|<\/textarea>|\/>))/gi, preg_attr = /(\w+)=\"(.?|.+?)\"/gi, preg_group = /<input.*?\/>/gi;
                if (!fields) fields = 0;

                var template_parse = template, template_data = new Array(), add_fields = new Object(), checkboxs = 0;
				var mobile_template=toMobile(template);
				
                var pno = 0;
                template.replace(preg, function(plugin, p1, p2, p3, p4, p5, p6) {
                    var parse_attr = new Array(), attr_arr_all = new Object(), name = '', select_dot = '', is_new = false;
                    var p0 = plugin;
                    var tag = p6 ? p6 : p4;
                    //alert(tag + " \n- t1 - "+p1 +" \n-2- " +p2+" \n-3- " +p3+" \n-4- " +p4+" \n-5- " +p5+" \n-6- " +p6);

                    if (tag == 'radios' || tag == 'checkboxs') {
                        plugin = p2;
                    } else if (tag == 'select') {
                        plugin = plugin.replace('|-', '');
                        plugin = plugin.replace('-|', '');
                    }
                    plugin.replace(preg_attr, function(str0, attr, val) {
                        if (attr == 'name') {
                            if (val == 'leipiNewField') {
                                is_new = true;
                                fields++;
                                val = 'data_' + fields;
                            }
                            name = val;
                        }

                        if (tag == 'select' && attr == 'value') {
                            if (!attr_arr_all[attr]) attr_arr_all[attr] = '';
                            attr_arr_all[attr] += select_dot + val;
                            select_dot = ',';
                        } else {
                            attr_arr_all[attr] = val;
                        }
                        var oField = new Object();
                        oField[attr] = val;
                        parse_attr.push(oField);
                    })
                    /*alert(JSON.stringify(parse_attr));return;*/
                    if (tag == 'checkboxs') /*复选组  多个字段 */
                    {
                        plugin = p0;
                        plugin = plugin.replace('|-', '');
                        plugin = plugin.replace('-|', '');
                        var name = 'checkboxs_' + checkboxs;
                        attr_arr_all['parse_name'] = name;
                        attr_arr_all['name'] = '';
                        attr_arr_all['value'] = '';

                        attr_arr_all['content'] = '<span leipiplugins="checkboxs"  title="' + attr_arr_all['title'] + '">';
                        var dot_name = '', dot_value = '';
                        p5.replace(preg_group, function(parse_group) {
                            var is_new = false, option = new Object();
                            parse_group.replace(preg_attr, function(str0, k, val) {
                                if (k == 'name') {
                                    if (val == 'leipiNewField') {
                                        is_new = true;
                                        fields++;
                                        val = 'data_' + fields;
                                    }

                                    attr_arr_all['name'] += dot_name + val;
                                    dot_name = ',';

                                }
                                else if (k == 'value') {
                                    attr_arr_all['value'] += dot_value + val;
                                    dot_value = ',';

                                }
                                option[k] = val;
                            });

                            if (!attr_arr_all['options']) attr_arr_all['options'] = new Array();
                            attr_arr_all['options'].push(option);
                            //if(!option['checked']) option['checked'] = '';
                            var checked = option['checked'] != undefined ? 'checked="checked"' : '';
                            attr_arr_all['content'] += '<input type="checkbox" name="' + option['name'] + '" value="' + option['value'] + '"  ' + checked + '/>' + option['value'] + '&nbsp;';

                            if (is_new) {
                                var arr = new Object();
                                arr['name'] = option['name'];
								arr['title'] = attr_arr_all['title'];
                                arr['leipiplugins'] = attr_arr_all['leipiplugins'];
                                add_fields[option['name']] = arr;

                            }

                        });
                        attr_arr_all['content'] += '</span>';

                        //parse
                        template = template.replace(plugin, attr_arr_all['content']);
                        template_parse = template_parse.replace(plugin, '{' + name + '}');
                        template_parse = template_parse.replace('{|-', '');
                        template_parse = template_parse.replace('-|}', '');
                        template_data[pno] = attr_arr_all;
                        checkboxs++;

                    } else if (name) {
                        if (tag == 'radios') /*单选组  一个字段*/
                        {
                            plugin = p0;
                            plugin = plugin.replace('|-', '');
                            plugin = plugin.replace('-|', '');
                            attr_arr_all['value'] = '';
                            attr_arr_all['content'] = '<span leipiplugins="radios" name="' + attr_arr_all['name'] + '" title="' + attr_arr_all['title'] + '">';
                            var dot = '';
                            p5.replace(preg_group, function(parse_group) {
                                var option = new Object();
                                parse_group.replace(preg_attr, function(str0, k, val) {
                                    if (k == 'value') {
                                        attr_arr_all['value'] += dot + val;
                                        dot = ',';
                                    }
                                    option[k] = val;
                                });
                                option['name'] = attr_arr_all['name'];
                                if (!attr_arr_all['options']) attr_arr_all['options'] = new Array();
                                attr_arr_all['options'].push(option);
                                //if(!option['checked']) option['checked'] = '';
                                var checked = option['checked'] != undefined ? 'checked="checked"' : '';
                                attr_arr_all['content'] += '<input type="radio" name="' + attr_arr_all['name'] + '" value="' + option['value'] + '"  ' + checked + '/>' + option['value'] + '&nbsp;';

                            });
                            attr_arr_all['content'] += '</span>';

                        } else {
                            attr_arr_all['content'] = is_new ? plugin.replace(/leipiNewField/, name) : plugin;
                        }
                        //attr_arr_all['itemid'] = fields;
                        //attr_arr_all['tag'] = tag;
                        template = template.replace(plugin, attr_arr_all['content']);
                        template_parse = template_parse.replace(plugin, '{' + name + '}');
                        template_parse = template_parse.replace('{|-', '');
                        template_parse = template_parse.replace('-|}', '');
                        if (is_new) {
                            var arr = new Object();
                            arr['name'] = name;
							arr['title'] = attr_arr_all['title'];
                            arr['leipiplugins'] = attr_arr_all['leipiplugins'];
                            add_fields[arr['name']] = arr;
                        }
                        template_data[pno] = attr_arr_all;


                    }
                    pno++;
                })
                var parse_form = new Object({
                    'fields': fields, //总字段数
                    'template': template, //完整html
                    'parse': template_parse, //控件替换为{data_1}的html
                    'data': template_data, //控件属性
                    'add_fields': add_fields,//新增控件
					'mobile':mobile_template//手机html
                });
                return JSON.stringify(parse_form);
            },
            /*type  =  save 保存设计 versions 保存版本  close关闭 */
            fnCheckForm: function(type) {
                if (leipiEditor.queryCommandState('source'))
                    leipiEditor.execCommand('source'); //切换到编辑模式才提交，否则有bug

                if (leipiEditor.hasContents()) {
                    leipiEditor.sync(); /*同步内容*/

                    //--------------以下仅参考-----------------------------------------------------------------------------------------------------
                    var type_value = '', formid = 0, fields = $("#fields").val(), formeditor = '';

                    if (typeof type !== 'undefined') {
                        type_value = type;
                    }
                    //获取表单设计器里的内容
                    formeditor = leipiEditor.getContent();
					//转为预览数据
					var preview=toPreview(formeditor);
					preview=toPreviewHead(preview);
                    //解析表单设计器控件
					var formtype=$('input:radio[name="formtype"]:checked').val();
                   // var parse_form = this.parse_form(formeditor, fields);
					//parse_form=parse_form.replace('{"fields":','{"formtype":"'+formtype+'","preview":"'+encodeURIComponent(preview)+'","fields":');
					//clipboardData.setData("text",parse_form);
                    var formeditor=leipiEditor.getContent();
                    //异步提交数据
                    $.ajax({
                        type: 'POST',
                        url: '/s/tp/wwwroot/index.php?s=/demo/formdesign/',
                        data: {form_id: modelId,'design_content':formeditor,'formtype':formtype},
                        dataType : 'json',
                        success: function(data) {
                        //data = eval('(' + data + ')');
                            if(data.result==1){
                                alert('保存成功');
                                 //$('#submitbtn').button('reset');
                                location.reload();
                            }else{
                             alert('保存失败：'+data.message);
                            }
                        },error: function(xhr, stat, e) { alert("保存失败：找不到地址！" ); }
                    });


                } else {
                    alert('表单内容不能为空！')
                    $('#submitbtn').button('reset');
                    return false;
                }
            },
            /*预览表单*/
            fnReview: function(type) {
                if (leipiEditor.queryCommandState('source'))
                    leipiEditor.execCommand('source'); /*切换到编辑模式才提交，否则部分浏览器有bug*/

                if (leipiEditor.hasContents()) {
                    leipiEditor.sync();       /*同步内容*/
                    
                    //--------------以下仅参考-------------------------------------------------------------------


                    /*设计form的target 然后提交至一个新的窗口进行预览*/
					var urlfile='fuview.htm';
					if(type=="mobile")urlfile='fuviewmobile.htm';
                    document.saveform.target = "mywin";
					//离线预览
					window.a54ab047bb2d228f1f39aa360db5e3eea = leipiEditor.getContent();//获取表单设计器里的内容
                    var newWindow=window.open(urlfile, 'mywin', "menubar=0,toolbar=0,status=0,resizable=1,left=0,top=0,scrollbars=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 50) + "\"");
					
					//在线解释后再预览
                    //var newWindow=window.open('', 'mywin', "menubar=0,toolbar=0,status=0,resizable=1,left=0,top=0,scrollbars=1,width=" + (screen.availWidth - 10) + ",height=" + (screen.availHeight - 50) + "\"");					
					//document.saveform.action = "http://127.0.0.1/fuview/fuview.php";
                    //document.saveform.submit(); //提交表单
					
                } else {
                    alert('表单内容不能为空！');
                    return false;
                }
            }
        };
}
var /*转为预览*/
toPreview=function(template_parse)
{
	template_parse = template_parse.replace(/\{\|-/gi, '');
	template_parse = template_parse.replace(/\-\|\}/gi, '');
	
	var element = document.createElement("div");
	$(element).append(template_parse);
	$(element).find("textarea").width("98.5%");
	$(element).find("select").width("");
	$(element).find("table").addClass("table");
	$(element).find("table").addClass("table-bordered");
	
	$(element).find('input:[leipiplugins=\"macros\"]').attr("value","宏控件");
	$(element).find('input:[orgtype=\"sys_date_select\"]').attr("value","");
	$(element).find('input:[orgtype=\"sys_date_select\"]').attr('placeholder','点击选择时间');
	$(element).find('input:[orgtype=\"sys_date_select\"]').attr("data-role","datebox");
	
	//解释列表控件
	toList(element);
	
	return $(element).html();
}
var/*转为手机版*/
toMobile=function(template_parse)
{
	//解释控件
	template_parse = template_parse.replace(/\{\|-/gi, '');
	template_parse = template_parse.replace(/\-\|\}/gi, '');
	
	var element = document.createElement("div");
	
	$(element).append(template_parse);
	$(element).find("textarea").width("100%");
	$(element).find("select").width("");
	$(element).find("select").attr("data-native-menu","false");
	$(element).find("table").width("100%");
	
	$(element).find("table").addClass("table");
	$(element).find("table").addClass("table-bordered");
	$(element).find("table").attr("data-sort","sortDisabled");
	
	$(element).find('input:[leipiplugins=\"macros\"]').attr("value","宏控件");	
	$(element).find('input:[orgtype=\"sys_date_select\"]').attr("value","");
	$(element).find('input:[orgtype=\"sys_date_select\"]').attr("data-role","datebox");
	$(element).find('input:[orgtype=\"sys_date_select\"]').attr('placeholder','点击选择时间');
	
	toList(element);
	
	for(;;)
	{
		//单选复选转为手机
		var tmp=null,temp="",isloop=false;
		var si=$(element).find("span");
		var i=0,l=si.length;
		for(i=0;i<l;i++)
		{
			if($(si[i].childNodes[0]).attr("type")!="radio" && $(si[i].childNodes[0]).attr("type")!="checkbox")continue;
			
			tmp=$(si[i]);//得到span
			temp=tmp.html();
			if($(si[i].childNodes[0]).attr("type")=="radio")temp=temp.replace(/\<input/gi,'<label class="ui-btn ui-corner-all ui-btn-inherit"><input');
			if($(si[i].childNodes[0]).attr("type")=="checkbox")temp=temp.replace(/\<input/gi,'<label class="ui-btn ui-corner-all ui-btn-inherit ui-btn-icon-left ui-first-child ui-checkbox-on"><input');
			temp=temp.replace(/\<label/gi,'</label><label');
			temp+='</label>';
			temp=temp.substring(8,temp.length);
			tmp.html(temp);
			isloop=true;break;
		}
		if(isloop==false)break;
	}
	return $(element).html();
}
var /*解释列表控件*/
toList=function(element)
{
	//转换列表
	var input=$(element).find("input"),inputl=input.length;
	for(i=0;i<inputl;i++)
	{
		var $this=input[i];
		var listctrl=$($this).attr("leipiplugins");
		if(listctrl!="listctrl")continue;
		var gtitle=$($this).attr("orgtitle").split("`");
		var gcoltype=$($this).attr("orgcoltype").split("`");
		var gunit=$($this).attr("orgunit").split("`");
		var gsum=$($this).attr("orgsum").split("`");
		var gcolvalue=$($this).attr("orgcolvalue").split("`");
		
		var th="",tr="",tf='';
		for(i2=0;i2<gtitle.length-1;i2++)
		{
			var orgcoltype=gcoltype[i2];
			var sum_total_html = '';
			if(gsum[i2]>0)//需要合计
			{
				orgcoltype='int';//必须数值
				sum_total_html = 'onblur="sum_total(\'data_list'+i+'['+i2+']\')"';
			}
					
			th+='<th>'+gtitle[i2]+'</th>';
			if(orgcoltype=="textarea")tr+='<td><textarea class="input-medium" name="data_list'+i+'['+i2+'][]" >'+gcolvalue[i2]+'</textarea> '+gunit[i2]+'</td>';
			if(orgcoltype=="text")tr+='<td><input class="input-medium" type="text" name="data_list'+i+'['+i2+'][]" value="'+gcolvalue[i2]+'"> '+gunit[i2]+'</td>';
			if(orgcoltype=="int")tr+='<td><input class="input-medium" '+sum_total_html+' type="text" name="data_list'+i+'['+i2+'][]" value="'+gcolvalue[i2]+'"> '+gunit[i2]+'</td>';

			//tfooter
			if(gsum[i2]>0)//需要合计
			{
				tf+='<td>合计：<input type="text" class="input-small" name="data_list'+i+'['+i2+'][total]" onblur="sum_total(\'data_list'+i+'['+i2+'][]\')" value="'+gcolvalue[i2]+'"> '+gunit[i2]+'</td>';
			}else
			{
				tf+='<td></td>';
			}
		}

		var B='';
		B+='<table id="data_list'+(i+1)+'_table" cellspacing="0" class="table table-bordered table-condensed" style="width: 100%;">';
			B+='<thead>';
				B+='<tr>';
					B+='<th colspan="'+(gtitle.length)+'">';
					B+=$($this).attr("title");
					B+='<span class="pull-right">';
					B+='<button class="btn btn-small btn-success" type="button" onclick="tbAddRow(\'data_list'+(i+1)+'\')">添加一行</button>';
					B+='</span>';
					B+='</th>';
				B+='</tr>';
				B+='<tr>';
				B+='</tr>';
				B+='<tr>';
					B+=th+'<th>操作</th>';
				B+='</tr>';
			B+='</thead>';
			B+='<tbody>';
				B+='<tr class="template">';
					B+=tr;
					B+='<td><a href="javascript:void(0);" onclick="fnDeleteRow(\'data_list'+(i+1)+'\',this)" class="delrow hide" style="display:none">删除</a></td>';
				B+='</tr>';
			B+='</tbody>';
		
			B+='<tbody>';
				B+='<tr>';
					B+=tf;
					B+='<td>&nbsp;</td>';
				B+='</tr>';
			B+='</tbody>';
		
		B+='</table>';

		
		$($this).before(B);
		$($this).remove();
	}
}


var /*转为带头部数据*/
toPreviewHead=function(preview)
{
	var out="";
	out+="<!DOCTYPE HTML>";
	out+="<html>";
	 out+="<head>";
		
		out+="<title>页面</title>";
		
		out+="<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />";
		out+="<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">";
		out+="<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">";
		out+="<meta name=\"author\" content=\"leipi.org\">";
		out+="<link href=\"/admin/pageEdit/formdesign/css/bootstrap/css/bootstrap.css\" rel=\"stylesheet\" type=\"text/css\" />";
		out+="\r\n<!--[if lte IE 6]>";
		out+="\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/admin/pageEdit/formdesign/css/bootstrap/css/bootstrap-ie6.css\">";
		out+="\r\n<![endif]-->";
		out+="\r\n<!--[if lte IE 7]>";
		out+="\r\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/admin/pageEdit/formdesign/css/bootstrap/css/ie.css\">";
		out+="\r\n<![endif]-->";
		out+="\r\n<link href=\"/admin/pageEdit/formdesign/css/site.css\" rel=\"stylesheet\" type=\"text/css\" />";
		
		out+="<script type=\"text/javascript\" charset=\"utf-8\" src=\"/admin/pageEdit/formdesign/js/jquery-1.7.2.min.js\"><"+"/script>";
		out+="<script type=\"text/javascript\" charset=\"utf-8\" src=\"/admin/pageEdit/formdesign/js/ueditor/ueditor.config.js\"><"+"/script>";
		out+="<script type=\"text/javascript\" charset=\"utf-8\" src=\"/admin/pageEdit/formdesign/js/ueditor/ueditor.all.js\"> <"+"/script>";
		out+="<script type=\"text/javascript\" charset=\"utf-8\" src=\"/admin/pageEdit/formdesign/js/ueditor/lang/zh-cn/zh-cn.js\"><"+"/script>";
		
		out+="<script type=\"text/javascript\" charset=\"utf-8\" src=\"/admin/pageEdit/formdesign/js/ueditor/formdesign/tolist.js\"><"+"/script>";
		
		out+="<script type=\"text/javascript\">";
			out+="var _root=\"\",_controller = \"index\";";
		out+="<"+"/script>";
	 out+="</head>";
	out+="<body>";
	
	out+="<div class=\"container\">";
	out+="<div id=\"design_content\">";
	out+=preview;
	out+="</div>";
	out+="</div><!--end container-->";
	out+="</body>";
	
	out+="</html>";
	return out;
}

</script>
<!-- script end -->


</body>
</html>