<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui">
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
	<meta http-equiv="Access-Control-Allow-Origin" content="*">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/openOutsideClass.css"/>
	<script src="js/jquery-1.12.4.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/publicJs.js" ></script>

		

	</style>
		
</head>
	<body>
		<!--<!--头部-->
			<div class="class_header row" style="margin: 0;">
				<div class="col-xs-2" onclick="javascript:history.go(-1);">
					<img src="images/fanhui@2x.png" alt="" />
				</div>
				<div class="header_message col-xs-7">开通班级</div>
				<div class="selectClass col-xs-3">

				</div>
			</div>
			
		<ul class="xiaoduan" style="padding: 0.35rem;">
			<li style="list-style:none;background-color: #F7F7F7;padding: 0.3rem;font-size: 0.2rem;margin-bottom: 0.15rem;">
				<select class="selectXiaoDuan" style="width: 100%;border: 0;background-color: #F7F7F7;outline: none;">
					<option value="0" style="outline: none;border: 0;">请选择校段</option>
					<option value="1">幼儿园</option>
					<option value="2">小学</option>
					<option value="3">初中</option>
					<option value="4">高中</option>
					<option value="5">大专</option>
					<option value="6">大学</option>
				</select>
			</li>
			<!--<li style="list-style:none;border-top: 1px solid darkgray;margin-bottom: 0.15rem;"></li>
			<li style="text-align: center;list-style:none;font-size: 0.2rem;margin-bottom: 0.15rem;">
				<select class="selectProvince" style="padding: 0.3rem;float: left;width: 30%;border: 0;background-color: #F7F7F7;outline: none;">
					<option value="0">省份</option>
				</select>
				<select class="selectCity" style="padding: 0.3rem;width: 30%;border: 0;background-color: #F7F7F7;outline: none;">
					<option value="0">市</option>

				</select>
				<select class="selectArea" style="padding: 0.3rem;float: right;width: 30%;border: 0;background-color: #F7F7F7;outline: none;">
					<option value="0">区</option>
				</select>
			</li>-->
			
			<!--<li style="list-style:none;border-top: 1px solid darkgray;margin-bottom: 0.15rem;"></li>
			<li style="list-style:none;background-color: #F7F7F7;padding: 0.3rem;font-size: 0.2rem;margin-bottom: 0.15rem;">
				<select style="width: 100%;border: 0;background-color: #F7F7F7;outline: none;">
					<option value="0" style="outline: none;border: 0;">请选择学校</option>

				</select>
			</li>-->
			<li style="list-style:none;border-top: 1px solid darkgray;margin-bottom: 0.15rem;"></li>
			<li style="list-style:none;background-color: #F7F7F7;padding: 0.3rem;font-size: 0.2rem;margin-bottom: 0.15rem;">
				<select class="selectGrade" style="width: 100%;border: 0;background-color: #F7F7F7;outline: none;">
					<option value="0" style="outline: none;border: 0;">请选择年级</option>

				</select>
			</li>
			
			<li style="list-style:none;border-top: 1px solid darkgray;margin-bottom: 0.15rem;"></li>
			<li class="className" style="list-style:none;background-color: #F7F7F7;padding: 0.3rem;font-size: 0.2rem;margin-bottom: 0.15rem;">
				<input type="text" placeholder="请输入班级名称" style="border: 0;outline: none;width: 100%;background-color: #F7F7F7;"/>
			</li>
		</ul>
		<p class="selectRemined" style="color: red;text-align: center;"></p>
		<div class="accept">
				<button style="background-color: #56c399;color: white;margin-bottom: 100px;">确定</button>
		</div>
			
			
		<!--底部栏-->
		<div id="footer">
			<ul>
				<li class="foot_li"><a href="/"><img src="images/nav_home_default@2x.png" class="img-responsive image_a " /><p>首页</p></a></li>
				<li class="foot_li"><a><img src="images/nav_home_jy_default@2x.png" class="img-responsive  image_b" /><p>教研</p></a></li>
				<li class="foot_li"><a href="classMeanage.html"><img src="images/nav_home_bj_default@2x.png" class="img-responsive  image_c" /><p>班级</p></a></li>
				<li class="foot_li"><a><img src="images/nav_home_xywh_default@2x.png" class="img-responsive  image_d" /><p>校园文化</p></a></li>
				<li class="foot_li"><a href="../../account/index.html#/account"><img src="images/nav_home_my_default@2x.png" class="img-responsive image_e" /><p>我</p></a></li>
			</ul>
		</div>
		
	</body>
	<script type="text/javascript" src="js/jquery-1.12.4.min.js" ></script>
	<script type="text/javascript" src="js/angular.min.js"></script>
	<script type="text/javascript" src="js/angular-route.min.js" ></script>
	<script type="text/javascript" src="js/publicJs.js" ></script>
	<script type="text/javascript">
		//渲染省份
		$.ajax({
			type:"post",
			url:"http://192.168.0.21:20882/addClassNormal/getMessage",
			data:JSON.stringify({'stageId':null,'provinceId':null,'cityId':null,'areaId':null}),
			contentType:"application/json; charset=UTF-8",
			dataType:"json",
			async:true,
			success:function(data){
				console.log(data);
				for(var i=0;i<data.msg.province.length;i++){
					var newOpction=$("<option></option>");
					newOpction.text(data.msg.province[i].province);
					newOpction.val(data.msg.province[i].provinceid);
					$(".selectProvince").append(newOpction);
				}
			},
			error:function(){
				console.log("获取学校信息失败");
			}
		})
			//渲染市
			$(".selectProvince").change(function(){
				var  options=$(".selectProvince option:selected");
				var provinceId=options.val();
//				console.log(provinceId);
				
				
				$(".selectCity").html("");
				var newOpction=$("<option></option>");
				newOpction.text("市");newOpction.val(0);
				$(".selectCity").append(newOpction);
				
				$(".selectArea").html("");
				var newOpction1=$("<option></option>");
				newOpction1.text("区");newOpction1.val(0);
				$(".selectArea").append(newOpction1);
				
				if(provinceId==0){

					return;
				}
				

				$.ajax({
					type:"post",
					url:"http://192.168.0.21:20882/addClassNormal/getMessage",
					data:JSON.stringify({'stageId':null,'provinceId':provinceId,'cityId':null,'areaId':null}),
					contentType:"application/json; charset=UTF-8",
					dataType:"json",
					async:true,
					success:function(data){
						console.log(data);				
						for(var i=0;i<data.msg.city.length;i++){
							var newOpction=$("<option></option>");
							newOpction.text(data.msg.city[i].city);
							newOpction.val(data.msg.city[i].cityid);
							$(".selectCity").append(newOpction);
						}
					},
					error:function(){
						console.log("获取学校信息失败");
					}
				})
				
				
				//渲染学校
				
				
				
			})
			
			//渲染区
			$(".selectCity").change(function(){
				var  options=$(".selectCity option:selected");
				var cityId=options.val();
				var provinceId=$(".selectProvince option:selected").val();
				console.log(cityId);
				
				$(".selectArea").html("");
				var newOpction=$("<option></option>");
				newOpction.text("区");newOpction.val(0);
				$(".selectArea").append(newOpction);
				
				if(cityId==0){
					return;
				}
	
				$.ajax({
					type:"post",
					url:"http://192.168.0.21:20882/addClassNormal/getMessage",
					data:JSON.stringify({'stageId':null,'provinceId':provinceId,'cityId':cityId,'areaId':null}),
					contentType:"application/json; charset=UTF-8",
					dataType:"json",
					async:true,
					success:function(data){
						console.log(data);
						
						for(var i=0;i<data.msg.area.length;i++){
							var newOpction=$("<option></option>");
							newOpction.text(data.msg.area[i].area);
							newOpction.val(data.msg.area[i].areaid);
							$(".selectArea").append(newOpction);
						}
					},
					error:function(){
						console.log("获取学校信息失败");
					}
				})
				
			})
			
			//渲染年级
			$(".selectXiaoDuan").change(function(){
				//渲染学校
				var provinceId=$(".selectProvince option:selected").val();
				var cityId=$(".selectCity option:selected").val();
				var areaId=$(".selectArea option:selected").val();
				
				if(provinceId==0){
					provinceId=cityId=areaId=null;
				}else{
					if(cityId==0){
						cityId=areaId=null;
					}else{
						if(areaId==0){
							areaId=null;
						}
					}
				}
				
				
				var  xiaoduanId=$(".selectXiaoDuan option:selected").val();
				console.log(xiaoduanId);
				$(".selectGrade").html("");
				var newOpction=$("<option></option>");
				newOpction.text("请选择年级");newOpction.val(0);
				$(".selectGrade").append(newOpction);
				if(xiaoduanId==0){
					return;
				}
				console.log(xiaoduanId,provinceId,cityId,areaId)
				$.ajax({
					type:"post",
					url:"http://192.168.0.21:20882/addClassNormal/getMessage",
					data:JSON.stringify({'stageId':xiaoduanId,'provinceId':provinceId,'cityId':cityId,'areaId':areaId}),
					contentType:"application/json; charset=UTF-8",
					dataType:"json",
					async:true,
					success:function(data){
						console.log(data);						
						for(var i=0;i<data.msg.grade.length;i++){
							var newOpction=$("<option></option>");
							newOpction.text(data.msg.grade[i].name);
							newOpction.val(data.msg.grade[i].id);
							$(".selectGrade").append(newOpction);
						}
					},
					error:function(){
						console.log("获取学校信息失败");
					}
				})
			})
			
			
			//点击确定
			$(".accept button").click(function(){
//				var provinceId=$(".selectProvince option:selected").val();
//				var cityId=$(".selectCity option:selected").val();
//				var areaId=$(".selectArea option:selected").val();
				var stageId=$(".selectXiaoDuan option:selected").val();
				var gradId=$(".selectGrade option:selected").val();
				var mark=$(".className input").val();
				
				if(mark==""||stageId==0||gradId==0){
					$(".selectRemined").text("请选择完整的信息！");
				}else{
					$(".selectRemined").text("");
				
				//提交开通班级
				$.ajax({
					type:"post",
					url:"http://192.168.0.21:20882/addClassNormal/isUserUpOrDown",
					data:JSON.stringify({'accountId':2}),
					contentType: "application/json; charset=UTF-8",
			        dataType:'json',
					async:true,
					success:function(data){
						console.log(data);						
						if(data.upORdown=="0"){
							var type=3;
						}else{
							var type=1;
						}
						$.ajax({
							type:"post",
							url:"http://192.168.0.21:20882/addClassOperation/openClassAuditApplyFor",
							data:JSON.stringify({'accountId':2,'stageId':stageId,'gradeId':gradId,'mark':mark,"type":type}),
							contentType: "application/json; charset=UTF-8",
							async:true,
							success:function(data){
								console.log(data);
								if(data.status=="1"){
									window.location.href="checking.html";
								}
							},
							error:function(){
								console.log("提交开通班级信息错误");
							}
							
						});
						
					},
					error:function(){
						console.log("提交开通班级信息错误");
					}
					
				});
				
				}
				
			})


				
			
			


		
		
	</script>
	
</html>