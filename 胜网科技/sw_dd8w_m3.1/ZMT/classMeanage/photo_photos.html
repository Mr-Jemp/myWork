<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/photo.css"/>
	</head>
	<body>
		
		<!--<!--头部-->
			<div class="class_header row" style="margin: 0;">
				<div class="col-xs-2" onclick="javascript:history.go(-1);">
					<img src="images/fanhui@2x.png" alt="" />
				</div>
				<div class="header_message col-xs-7">初一（2）班相册</div>
				<div type="button" class="selectClass col-xs-3" >
					<img src="images/gengduo@2x.png" style="width: 0.45rem;" />
				</div>
				<input type="button" class="col-xs-3"  value="上传" id="upimage"/ style="cursor: pointer;display: none;border: 0;background-color: #56c399; color:white;font-size:0.24rem;height:100%;">
				<div class="sureDele col-xs-3" style="display:none">
					确定
				</div>
			</div>
		
		<div class="photo_beforeUploading">
			<!--<div class="photos_photos">
				<p>
					上传照片/视频
				</p>
			</div>-->
			<div class="createButton" style="margin-top: 1rem;">
                <p  onclick='$("#form1 input:last-child").click();'>上传照片/视频</p>
             </div>         
<!--		    <input type="file" multiple="multiple" onchange="previewImage(this)" style="display: none;" id="previewImg">-->
			
			<!--罗列照片-->
			<div class="photos_list">
				<!--<p class="time">2017/5/<span>18</span></p>
				<ul class="row">
					<li class="col-xs-4 col-lg-2 col-md-3 col-sm-3">
						<img src="images/20170520142547.png" alt="" />
						<div><p class="redactCheckbox"></p></div>
					</li>
			
				</ul>-->
	

			</div>
			
			
			<!--评论-->
			<div class="discuss row" style="margin: 0;">
				<!--评论-->
					<p style="width: 40%;"><input type="text" placeholder="评论" /></p>
					<p>发送</p>
					<p class="discuss_goods"><img src="images/dianzan@2x.png" /><sup>0</sup></p>
					<p class="discuss_comments"><img src="images/pinglun@2x.png" ><sup>0</sup></p>
			</div>
			
			<p style="height: 0.7rem;"></p>
			
			<!--编辑相册信息-->
			<div class="redactPhotosMes redactPhotosMesDisplay">
				<ul>
					<li> <img src="images/bianji@2x.png" alt="" />编辑相册信息</li>
					<li> <img src="images/shanchu@2x.png" alt="" />删除</li>
					<li style="color: rgba(0,0,0,0);">55</li>
				</ul>
				<p></p>
			</div>
		</div>
		<!--上传-->
		<div class="upLading" style="margin-top: 0.6rem;">
				<div>
					<textarea class="describesPhotos_Photos" name="" rows="" cols="" placeholder="说点什么吧......"></textarea>
				</div>
				<p></p>
				<div class="row">
					<p class="col-xs-4" style="margin: 0;">上传到</p>
					<p class="col-xs-8" style="margin: 0;">	
						<select class="selectPhotos_Photos">
						</select>
					</p>
				</div>
				<p></p>
				<!-- 拿来放图片用的 -->
				<ul id="preview">
					<!--<li class="col-xs-4 col-lg-2 col-md-3 col-sm-3">
						<img src="images/zhaoxiang@2x.png" style="width: 0.4rem;height: 0.35rem;" /><br/>
						
					</li>-->
					
					<li class="photoOrVideo"  onclick='$("#form1 input:last-child").click();' style="flex-direction:column">
						<img src="images/zhaoxiang@2x.png" style="width: 0.4rem;height: 0.35rem;" /><br/>
						<span>照片/视频</span>
					</li>
				</ul>

				
				<!--隐藏的input-->
				<div style="display:none">
					<form enctype="multipart/form-data" id="form1" method="post" action="">
						文件:
 						<input type="file" name="upfile" class="firstInput" id="upfile" multiple="multiple" onchange="previewImage(this)">
					</form>
				</div>
		</div>
		
		<!--编辑相册相册-->
			<div class="createPhotoBG" style="display: none;">
				<ul>
					<li>
						<img src="images/chacha-@2x.png"/>
						<span>保存</span>
					</li>
					<li style="border-bottom: 1px solid darkgray;">
						<input class="repairTitle" type="text" placeholder="标题" style="border: 0;width: 100%;outline: none;"/>
					</li>
					<li>
						<textarea class="descriptphotos_Photos" rows="" cols="" placeholder="描述"></textarea>
					</li>
					<li class="delePhotos"><span>删除相册</span></li>
				</ul>
			</div>
			
			
			<!--放大照片-->
			<div class="scaleImgDiv">
				<div class="scaleImgHeader   row" style="margin: 0;background-color: black;height: 10%;">
					<div class="col-xs-2">
						<img onclick='$(".scaleImgDiv").css("display","none")' style="width: 0.2rem;cursor: pointer;margin-left: 0.35rem;" src="images/fanhui@2x.png" alt="" />
					</div>
					<div class="header_message col-xs-7" style="font-size: 0.3rem;">初二（2）班相册
						<p style="font-size: 0.24rem;">1/13</p>
					</div>
					<div class="selectClass col-xs-3"></div>
				</div>
				<div class="scaleImg">
					<img src="images/20170520142547.png" alt="" />
				</div>
				<p class="scaleImgUpload">2016年6月10日上传</p>
				<div class="scaleImgBottom">
						<!--评论-->
					<p style="width: 40%;"><input type="text" placeholder="评论" /></p>
					<p>发送</p>
					<p><img src="images/dianzan@2x.png" /><sup>0</sup></p>
					<p><img src="images/pinglun@2x.png" ><sup>0</sup></p>
				</div>
			</div>
			
			<!--单张照片点赞评论-->
			<div class="singlePhotosComment">
				<div>
					<span>评论（0）</span>
					<img src="images/fanhuixiangxia@2x.png" style="float: right;" />
				</div>
				<ul class="singleCommentCenter" id="contant1">
					<li class="row" style="margin: 0;">
						<div>
							<p class="col-xs-4">
								<img src="images/20170519104219.png" alt="" />
							</p>
							<p class="col-xs-4">
								<span>小红</span>
								<span>20分钟前</span>
							</p>
							<!--....评论-->
							<p class="col-xs-4">
								<img src="images/dianzan@2x.png" alt="" />
								<img src="images/pinglun@2x.png" alt="" />
							</p>
						</div>
						<p style="margin-left: 1rem;">
							<span class="col-xs-10">哈哈哈</span>
						</p>
					</li>
					<li class="row" style="margin: 0;">
						<div>
							<p class="col-xs-4">
								<img src="images/20170519104219.png" alt="" />
							</p>
							<p class="col-xs-4">
								<span>小红</span>
								<span>20分钟前</span>
							</p>
							<!--....评论-->
							<p class="col-xs-4">
								<img src="images/dianzan@2x.png" alt="" />
								<img src="images/pinglun@2x.png" alt="" />
							</p>
						</div>
						<p style="margin-left: 1rem;">
							<span class="col-xs-10">哈哈哈</span>
						</p>
					</li>
				</ul>
				<p class="simgleComment"><input type="text" placeholder="评论"/> <span>发送</span></p>
			</div>
			
	</body>
	
	<script type="text/javascript" src="js/jquery-1.12.4.min.js" ></script>
	<script type="text/javascript" src="http://malsup.github.io/jquery.form.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/publicJs.js" ></script>
	<script type="text/javascript" src="js/photo_uploading.js"></script>
	<script type="text/javascript">
	
	
	//知悉相册是视频还是照片
	$.ajax({
		type:"get",
		url:"http://192.168.0.21:20883/classAlbumService/dataGridTypeAll?class_id=1",
		async:true,
		success:function(data){
			console.log(data);
			for(var i in data){
				if(data[i].classAlbum_id==photosId){
					is_pic=data[i].is_pic;
					//如果照片为空，加个图片
					if(is_pic==undefined){
						console.log(is_pic)
						var newDiv=$('<div class="submitPhotoOrVideo">'
										+'<div class="createPhoto">'
											+'<img src="images/tupian@2x.png"/>'
										+'</div>'
									+'<div/>');
							$(".createButton").before(newDiv)
					}
					//获取点赞数据
					$(".discuss_goods sup").text(data[i].good_count);	
					is_pic=data[i].is_pic;
				}
			}
		}
	})
	
	console.log(photosId,is_pic+"***");
		//渲染照片
		$.ajax({
			type:"get",
			url:"http://192.168.0.21:20883/classAlbumService/dataGridXCInfo?classAlbum_id="+photosId+"&class_id=1",
			async:true,
			dataType:"json",
			success:function(data){
				
				if(is_pic=="0"){//照片
					var type1="<img";
					var type2='" />';
				}else{
					var type1="<video";
					var type2='"></video>';
				}
				console.log(data);
				for(var i in data){
					var newI=i.split("-");
					var newP=$('<p class="time">'+newI[0]+"/"+newI[1]+'/<span>'+newI[2]+'</span></p>');
					$(".photos_list").append(newP);
					var newUl=$('<ul class="row"></ul>');
					$(".photos_list").append(newUl);
					
					for(var j=0;j<data[i].length;j++){
						var type=type1+' src="http://192.168.0.21:8000/'+data[i][j].file_url+type2;
						var newLi=$('<li class="col-xs-4 col-lg-2 col-md-3 col-sm-3">'
									+type
									+'<div classAlbumFile_id="'+data[i][j].classAlbumFile_id+'"><p class="redactCheckbox"></p></div>'
								  +'</li>')
						newUl.append(newLi);
					}
				}
			},
			error:function(){
				console.log("错误");
			}
		});
		
		
	
		
		//点击保存
			$(".createPhotoBG li:first-child span").click(function(){
				$(".createPhotoBG").css("display","none");	
				var repairTitle=$(".repairTitle").val();
				var descriptphotos_Photos=$(".descriptphotos_Photos").val();
				if(repairTitle==""&&descriptphotos_Photos==""){
					return;
				}
				console.log(photosId,repairTitle,descriptphotos_Photos)
				$(".repairTitle").val("");
				$(".descriptphotos_Photos").val("");
				$.ajax({
					type:"post",
					url:"http://192.168.0.21:20883/classAlbumService/Update?classAlbum_id="+photosId+"&class_id=1&title="+repairTitle+"&describes="+descriptphotos_Photos,
					dataType:"json",
					async:true,
					success:function(data){
						console.log(data)
					},
					error:function(){
						console.log("错误");
					}
				})
				
				
				
			})
			
			$(".delePhotos").click(function(){
				//删除相册
				$.ajax({
					type:"post",
					url:"http://192.168.0.21:20883/classAlbumService/getDeleteClassAlbum?classAlbumId="+photosId+"&class_id=1",
					async:true,
					dataType:"json",
					success:function(data){
						console.log(data);
						if(data==true){
							$(".createPhotoBG").css("display","none");
							$(".class_header .col-xs-2").click();
						}
					},
					error:function(){
						console.log("错误");
					}
				})
			})

		
		
		

	</script>

</html>
